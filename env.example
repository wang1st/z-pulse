# ============================================
# Z-Pulse 环境变量配置模板
# ============================================
# 使用方法：
# 1. 复制此文件为 .env: cp env.example .env
# 2. 根据实际情况修改以下配置
# 3. 注意：.env 文件不应提交到版本控制系统
# ============================================

# ============================================
# ⚠️ 必需配置项（必须修改）
# ============================================
# 以下配置项是系统运行所必需的，请务必修改为实际值：
#
# 1. 数据库密码
#    POSTGRES_PASSWORD=your_strong_password_here
#
# 2. Redis 密码
#    REDIS_PASSWORD=your_redis_password_here
#
# 3. 阿里云 DashScope API 密钥
#    DASHSCOPE_API_KEY=your_dashscope_api_key_here
#    获取地址：https://dashscope.aliyuncs.com/
#
# 4. 邮件服务配置（至少配置一个）
#    EMAIL_PROVIDER=brevo  # 或 sendgrid
#    BREVO_API_KEY=your_brevo_api_key_here  # 如果使用 Brevo
#    # 或
#    SENDGRID_API_KEY=your_sendgrid_api_key_here  # 如果使用 SendGrid
#
# 5. 发件人邮箱
#    EMAIL_FROM=noreply@example.com
#
# ============================================
# 提示：配置完成后，请继续查看下面的可选配置项
# ============================================

# ============================================
# 数据库配置（必需）
# ============================================
POSTGRES_USER=zpulse
POSTGRES_PASSWORD=your_strong_password_here
POSTGRES_DB=zpulse
POSTGRES_HOST=postgres-db
POSTGRES_PORT=5432

# ============================================
# Redis 配置（必需）
# ============================================
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=your_redis_password_here

# ============================================
# 阿里云 DashScope (Qwen) 配置（必需）
# ============================================
# 获取地址：https://dashscope.aliyuncs.com/
DASHSCOPE_API_KEY=your_dashscope_api_key_here

# Qwen 模型选择（可选，有默认值）
# 晨报生成模型（默认：qwen-plus）
QWEN_DAILY_MODEL=qwen-plus
# 文章筛选模型（默认：qwen-flash）
QWEN_FILTER_MODEL=qwen-flash
# 周报生成模型（默认：qwen-max-latest）
QWEN_WEEKLY_MODEL=qwen-max-latest
# 关键词提取模型（默认：qwen-flash）
QWEN_KEYWORDS_MODEL=qwen-flash

# ============================================
# 邮件服务配置（必需）
# ============================================
# 邮件服务提供商：brevo（推荐）、sendgrid、mailgun
EMAIL_PROVIDER=brevo

# Brevo (原Sendinblue) 配置（推荐，免费额度300封/天）
BREVO_API_KEY=your_brevo_api_key_here

# SendGrid 配置（可选，免费额度100封/天）
# SENDGRID_API_KEY=your_sendgrid_api_key_here

# Mailgun 配置（可选）
# MAILGUN_API_KEY=your_mailgun_api_key_here
# MAILGUN_DOMAIN=your_mailgun_domain_here

# 发件人配置
EMAIL_FROM=noreply@example.com
EMAIL_FROM_NAME=浙财脉动

# 是否在邮件中包含PDF附件（默认：true）
ENABLE_PDF_ATTACHMENT=true

# ============================================
# Web 配置（可选）
# ============================================
# 网站URL（生产环境需要修改为实际域名）
WEB_URL=http://localhost:3000
# 前端API URL（生产环境需要修改为实际域名）
NEXT_PUBLIC_API_URL=http://localhost:8000

# ============================================
# we-mp-rss 配置（可选）
# ============================================
# RSS桥接服务URL（容器内使用）
RSS_BRIDGE_URL=http://rss-bridge:8001
# RSS基础URL（外部访问）
RSS_BASE_URL=http://localhost:8080
# we-mp-rss 密钥
WERSS_SECRET_KEY=zpulse-rss

# we-mp-rss 管理员账号（用于后台查看文章时按需回源抓取全文）
WERSS_ADMIN_USERNAME=admin
WERSS_ADMIN_PASSWORD=admin@123

# ============================================
# 数据采集配置（可选）
# ============================================
# 采集间隔（秒，默认：1800，即30分钟）
POLL_INTERVAL=1800
# 采集错峰时间（分钟，默认：5）
INGEST_OFFSET_MINUTES=5
# 采集运行时间（仅在每天一次模式生效）
INGEST_RUN_AT=21:00

# 最早采集日期（YYYY-MM-DD，不采集此日期之前的文章）
MIN_ARTICLE_DATE=2025-12-15

# 全文抓取配置
FETCH_FULL_CONTENT=true
FULLTEXT_TIMEOUT=80
FULLTEXT_MAX_RETRIES=4
FULLTEXT_RETRY_BASE_SLEEP=2
FULLTEXT_MIN_INTERVAL=2

# we-mp-rss 数据库直读配置（避免HTTP超时）
USE_WERSS_DB=true
WERSS_DB_PATH=/app/werss_data/werss.db
WERSS_DB_LIMIT=400

# ============================================
# 报告生成配置（可选）
# ============================================
# 晨报生成时间（默认：09:45）
DAILY_REPORT_TIME=09:45
# 周报生成日期（默认：sunday）
WEEKLY_REPORT_DAY=sunday
# 周报生成时间（默认：22:00）
WEEKLY_REPORT_TIME=22:00

# 晨报格式（默认：smart_brevity）
# 可选值：smart_brevity（推荐）、voice（已废弃）
DAILY_REPORT_FORMAT=smart_brevity

# 报告生成输入限制（可选）
# 最大输入字符数（默认：180000）
DAILY_REPORT_MAX_INPUT_CHARS=180000
# 每篇文章最大字符数（默认：12000）
DAILY_REPORT_PER_ARTICLE_MAX_CHARS=12000

# 报告任务过期时间（分钟，默认：60）
REPORT_JOB_STALE_MINUTES=60

# 热点提取配置（可选）
# 热点时间窗口（天，默认：3）
# 注意：RECENT_HOTWORDS_WINDOW_DAYS 是旧变量名，已废弃，请使用 RECENT_HOTSPOTS_WINDOW_DAYS
RECENT_HOTSPOTS_WINDOW_DAYS=3
# 热点数量上限（默认：8）
RECENT_HOTSPOTS_TOP_K=8
# 标签总和阈值（默认：2）
RECENT_HOTSPOTS_TAG_SUM_THRESHOLD=2
# 聚类最大项目数（默认：120）
RECENT_HOTSPOTS_CLUSTER_MAX_ITEMS=120
# 一句话摘要提示词版本（默认：v1）
RECENT_HOTSPOTS_ONELINER_PROMPT_VERSION=v1
# 一句话摘要批处理大小（默认：8）
RECENT_HOTSPOTS_ONELINER_BATCH=8

# 邮件发送配置（可选）
# 每日邮件最大发送数（默认：5000）
DAILY_EMAIL_MAX_PER_RUN=5000
# 每日邮件批处理提交间隔（默认：20）
DAILY_EMAIL_COMMIT_EVERY=20
# 周报邮件最大发送数（默认：5000）
WEEKLY_EMAIL_MAX_PER_RUN=5000
# 周报邮件批处理提交间隔（默认：20）
WEEKLY_EMAIL_COMMIT_EVERY=20

# ============================================
# 应用配置（可选）
# ============================================
# 环境：development、production
ENVIRONMENT=development
# 调试模式（默认：false）
DEBUG=false
# 日志级别：DEBUG、INFO、WARNING、ERROR（默认：INFO）
LOG_LEVEL=INFO
# 日志格式：json、text（默认：json）
LOG_FORMAT=json

# ============================================
# 通知 Webhook（可选）
# ============================================
# 钉钉 Webhook
# DINGDING_WEBHOOK=https://oapi.dingtalk.com/robot/send?access_token=xxx
# 企业微信 Webhook
# WECHAT_WEBHOOK=https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=xxx
# 飞书 Webhook
# FEISHU_WEBHOOK=https://open.feishu.cn/open-apis/bot/v2/hook/xxx

# ============================================
# 数据文件路径配置（可选，有默认值）
# ============================================
# 微信文章清理规则文件路径（可选）
# 用于清理微信文章中的模板文本（如"阅读原文"、"二维码"等）
# 默认使用内置规则，可通过此配置覆盖或追加自定义规则
# ZPULSE_WECHAT_KILL_PATTERNS_PATH=/path/to/kill_patterns.txt

# 自定义词典路径（可选，默认：data/templates/zhejiang_finance_dict.txt）
# 用于加载自定义词典到 jieba 分词器，提高财政相关术语的识别准确度
# ZPULSE_CUSTOM_DICT_PATH=/path/to/custom_dict.txt

# ============================================
# 部署配置（可选，用于自动部署脚本）
# ============================================
# 服务器 root 密码（用于自动部署脚本 scripts/deploy-to-server.sh）
# 注意：建议使用 SSH 密钥认证而不是密码
# 配置 SSH 密钥：ssh-copy-id root@your-server-ip
# SCP_ROOT_PASSWORD=your_server_root_password

# ============================================
# 敏感词过滤配置（可选）
# ============================================
# 敏感词短语列表（逗号分隔，可选）
# 用于在报告生成时自动检测和脱敏敏感内容
# 默认包含：机密、内部资料等常见敏感词
# ZPULSE_SENSITIVE_PHRASES=敏感词1,敏感词2,敏感词3

# ============================================
# 其他配置（可选）
# ============================================
# 时区（默认：Asia/Shanghai）
TZ=Asia/Shanghai

# ============================================
# 注意事项
# ============================================
# 1. 所有密码和密钥都应该使用强密码
# 2. 生产环境必须修改 WEB_URL 和 NEXT_PUBLIC_API_URL
# 3. 生产环境建议启用 HTTPS
# 4. 定期备份数据库和配置文件
# 5. 不要将 .env 文件提交到版本控制系统

